<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Module: Stanford::SearchworksHelper</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo; 
    <span class='title'>Stanford</span>
     &raquo; 
    <span class="title">SearchworksHelper</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Stanford::SearchworksHelper
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
      <dt class="r1">Includes:</dt>
      <dd class="r1">SolrHelper</dd>
      
    
  
  
    <dt class="r2">Included in:</dt>
    <dd class="r2"><span class='object_link'><a href="../ApplicationHelper.html" title="ApplicationHelper (module)">ApplicationHelper</a></span></dd>
    
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/stanford/searchworks_helper.rb</dd>
  
</dl>
<div class="clear"></div>



  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_856-instance_method" title="#get_856 (instance method)">- (Object) <strong>get_856</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate unordered list of Online Access Links (IE marc 856s).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_advanced_search_filter_terms-instance_method" title="#get_advanced_search_filter_terms (instance method)">- (Object) <strong>get_advanced_search_filter_terms</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_advanced_search_query_terms-instance_method" title="#get_advanced_search_query_terms (instance method)">- (Object) <strong>get_advanced_search_query_terms</strong>(params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_callnum-instance_method" title="#get_callnum (instance method)">- (Object) <strong>get_callnum</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_data_with_label-instance_method" title="#get_data_with_label (instance method)">- (Object) <strong>get_data_with_label</strong>(doc, label, field_string, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate a dt/dd pair given a Solr field If you provide a :default value in
the opts hash,  then when the solr field is empty, the default value will
be used.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_data_with_label_from_marc-instance_method" title="#get_data_with_label_from_marc (instance method)">- (Object) <strong>get_data_with_label_from_marc</strong>(doc, label, field, sFields = []) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
generate an dt/dd pair given a marc field.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_facet_tag_cloud-instance_method" title="#get_facet_tag_cloud (instance method)">- (Object) <strong>get_facet_tag_cloud</strong>(facet, response) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_nearby_items-instance_method" title="#get_nearby_items (instance method)">- (Object) <strong>get_nearby_items</strong>(document, response, how_many) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate display text for &#8220;nearby&#8221; selections according to call
number.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_refine_facet-instance_method" title="#get_refine_facet (instance method)">- (Object) <strong>get_refine_facet</strong>(solr_fname, response) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
given the solr field name of a <b>refinement</b> facet (e.g.
lc_alpha_facet), return a string containing appropriate html to display the
given facet heading and its values.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_relevance_bar-instance_method" title="#get_relevance_bar (instance method)">- (Object) <strong>get_relevance_bar</strong>(score, label) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Genrate dt/dd with a relevance.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_search_breadcrumb_terms-instance_method" title="#get_search_breadcrumb_terms (instance method)">- (Object) <strong>get_search_breadcrumb_terms</strong>(q_param) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_subjects-instance_method" title="#get_subjects (instance method)">- (Object) <strong>get_subjects</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate hierarchical structure of subject headings from marc.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_suppl_urls-instance_method" title="#get_suppl_urls (instance method)">- (Object) <strong>get_suppl_urls</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_toc-instance_method" title="#get_toc (instance method)">- (Object) <strong>get_toc</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate dt/dd pair with an unordered list from the table of contents (IE
marc 505s).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_vernacular-instance_method" title="#get_vernacular (instance method)">- (Object) <strong>get_vernacular</strong>(doc, field) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#home_facet_field_labels-instance_method" title="#home_facet_field_labels (instance method)">- (Object) <strong>home_facet_field_labels</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#home_facet_field_names-instance_method" title="#home_facet_field_names (instance method)">- (Object) <strong>home_facet_field_names</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#link_back_to_catalog-instance_method" title="#link_back_to_catalog (instance method)">- (Object) <strong>link_back_to_catalog</strong>(opts = {:label=&gt;'Back to Search'}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
link_back_to_catalog(:label=>&#8217;Back to Search&#8217;) Create a link
back to the index screen, keeping the user&#8217;s facet, query and paging
choices intact by using session.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#link_to_contributor_from_marc-instance_method" title="#link_to_contributor_from_marc (instance method)">- (Object) <strong>link_to_contributor_from_marc</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate dt/dd pair of contributors with translations.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#link_to_data_with_label-instance_method" title="#link_to_data_with_label (instance method)">- (Object) <strong>link_to_data_with_label</strong>(doc, label, field_string, url) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate a dt/dd pair with a link with a label given a field in the
SolrDocument.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#link_to_data_with_label_from_marc-instance_method" title="#link_to_data_with_label_from_marc (instance method)">- (Object) <strong>link_to_data_with_label_from_marc</strong>(doc, label, field, url, sFields = []) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate dt/dd pair with a link with a label given a marc field.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#link_to_next_document-instance_method" title="#link_to_next_document (instance method)">- (Object) <strong>link_to_next_document</strong>(next_document) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
overriding because we need to escape the &#8216;Next >&#8217; at the
linking level.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#link_to_previous_document-instance_method" title="#link_to_previous_document (instance method)">- (Object) <strong>link_to_previous_document</strong>(previous_document) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
overriding because we need to escape the &#8217;< Previous&#8217; at the
linking level.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#link_to_with_data-instance_method" title="#link_to_with_data (instance method)">- (Object) <strong>link_to_with_data</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This is an updated <tt>link_to</tt> that allows you to pass a <tt>data</tt>
hash along with the <tt>html_options</tt> which are then written to the
generated form for non-GET requests.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#params_facet_has_value%3F-instance_method" title="#params_facet_has_value? (instance method)">- (Boolean) <strong>params_facet_has_value?</strong>(field) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
true or false, depending on whether the field and a value is in params[:f].
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#previous_search_is_referrer%3F-instance_method" title="#previous_search_is_referrer? (instance method)">- (Boolean) <strong>previous_search_is_referrer?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#referrer_params-instance_method" title="#referrer_params (instance method)">- (Object) <strong>referrer_params</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_query_params-instance_method" title="#remove_query_params (instance method)">- (Object) <strong>remove_query_params</strong>(value, source_params = params) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
copies the current params (or whatever is passed in as the 3rd arg) removes
the field value from params[:f] removes the field if there are no more
values in params[:f][field] removes additional params (page, id, etc..).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#results_text-instance_method" title="#results_text (instance method)">- (Object) <strong>results_text</strong>(pp, p, result_num) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate the # - # of # results text.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show_formats-instance_method" title="#show_formats (instance method)">- (Object) <strong>show_formats</strong>(field) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Generate a dt/dd pair with a comma separated list of formats given an array
of format strings.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#title_change_data_from_marc-instance_method" title="#title_change_data_from_marc (instance method)">- (Object) <strong>title_change_data_from_marc</strong>(doc) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#url_back_to_catalog-instance_method" title="#url_back_to_catalog (instance method)">- (Object) <strong>url_back_to_catalog</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
url back to catalog show the url back to the search result, keeping the
user&#8217;s facet, query and paging choices intact by using session.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#vern_document_heading-instance_method" title="#vern_document_heading (instance method)">- (Object) <strong>vern_document_heading</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
def application_name.
</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="get_856-instance_method">
  
    - (<tt>Object</tt>) <strong>get_856</strong>(doc) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate unordered list of Online Access Links (IE marc 856s)
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 484</span>

<span class='def def kw'>def</span> <span class='get_856 identifier id'>get_856</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'856'</span><span class='rbrack token'>]</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>''</span>
    <span class='int identifier id'>int</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;ul class='online'&gt;&quot;</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;li&gt;&quot;</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;ol&gt;&quot;</span>
          <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'856'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='bitor op'>|</span>
            <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='field identifier id'>field</span><span class='lbrack token'>[</span><span class='string val'>'u'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
              <span class='comment val'># Not sure why I need this, but it fails on certain URLs w/o it.  The link printed still has character in it</span>
              <span class='fixed_url identifier id'>fixed_url</span> <span class='assign token'>=</span> <span class='field identifier id'>field</span><span class='lbrack token'>[</span><span class='string val'>'u'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;^&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
              <span class='url identifier id'>url</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='fixed_url identifier id'>fixed_url</span><span class='rparen token'>)</span>
              <span class='sub3 identifier id'>sub3</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
              <span class='subz identifier id'>subz</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
              <span class='suby identifier id'>suby</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
              <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='subfield identifier id'>subfield</span><span class='bitor op'>|</span> 
                <span class='if if kw'>if</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;3&quot;</span>
                  <span class='sub3 identifier id'>sub3</span> <span class='assign token'>=</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='value identifier id'>value</span>
                <span class='elsif elsif kw'>elsif</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;z&quot;</span>
                  <span class='subz identifier id'>subz</span> <span class='lshft op'>&lt;&lt;</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='value identifier id'>value</span>
                <span class='elsif elsif kw'>elsif</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;y&quot;</span>
                  <span class='suby identifier id'>suby</span> <span class='assign token'>=</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='value identifier id'>value</span>
                <span class='end end kw'>end</span>
              <span class='rbrace token'>}</span>
              <span class='if if kw'>if</span> <span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>3</span>
                <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;&lt;li class='more' style='display:none;'&gt;#{!sub3.blank? ? sub3 &lt;&lt; ' ' : ''}#{!subz[0].blank? ? subz[0] &lt;&lt; ' ' : ''}&lt;a href='#{field['u']}'&gt;#{(subz[1] and field['x'] == &quot;eLoaderURL&quot;) ? subz[1] : !suby.blank? ? suby : url.host}&lt;/a&gt;&lt;/li&gt;&quot;</span>
              <span class='else else kw'>else</span>
                <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;&lt;li&gt;#{!sub3.blank? ? sub3 &lt;&lt; ' ' : ''}#{!subz[0].blank? ? subz[0] &lt;&lt; ' ' : ''}&lt;a href='#{field['u']}'&gt;#{(subz[1] and field['x'] == &quot;eLoaderURL&quot;) ? subz[1] : !suby.blank? ? suby : url.host}&lt;/a&gt;&lt;/li&gt;&quot;</span>
              <span class='end end kw'>end</span>
              <span class='if if kw'>if</span> <span class='int identifier id'>int</span> <span class='eq op'>==</span> <span class='integer val'>3</span> <span class='and and kw'>and</span> <span class='field identifier id'>field</span> <span class='neq op'>!=</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'856'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
                <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;li class='more_link' id='more_link'&gt;&lt;a href=''&gt;more&lt;span class='off_screen'&gt; links&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;</span>
              <span class='end end kw'>end</span>
              <span class='int identifier id'>int</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
          <span class='if if kw'>if</span> <span class='int identifier id'>int</span> <span class='gt op'>&gt;</span> <span class='integer val'>3</span> 
            <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;li id='less_link' class='less_link' style='display:none;'&gt;&lt;a href=''&gt;less&lt;span class='off_screen'&gt; links&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;</span>
          <span class='end end kw'>end</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/ol&gt;&quot;</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/li&gt;&quot;</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/ul&gt;&quot;</span>
    <span class='text identifier id'>text</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_advanced_search_filter_terms-instance_method">
  
    - (<tt>Object</tt>) <strong>get_advanced_search_filter_terms</strong>(params) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 740</span>

<span class='def def kw'>def</span> <span class='get_advanced_search_filter_terms identifier id'>get_advanced_search_filter_terms</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='comment val'># Modifying the fq param to be what the UI is expecting from the f param, then setting the f param to this modified hash</span>
  <span class='comment val'># Note that the query to Solr has already been made, anything beyond this will just be modifying how the UI interperets the query</span>
  <span class='unless unless kw'>unless</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:fq</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='a_hash identifier id'>a_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='fq_params identifier id'>fq_params</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:fq</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;), &quot;</span><span class='rparen token'>)</span>
    <span class='fq_params identifier id'>fq_params</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fq_param identifier id'>fq_param</span><span class='bitor op'>|</span>
      <span class='fq_fields identifier id'>fq_fields</span> <span class='assign token'>=</span> <span class='fq_param identifier id'>fq_param</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span>
      <span class='fq_field identifier id'>fq_field</span> <span class='assign token'>=</span> <span class='fq_fields identifier id'>fq_fields</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='fq_values identifier id'>fq_values</span> <span class='assign token'>=</span> <span class='fq_fields identifier id'>fq_fields</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='fq_fields identifier id'>fq_fields</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='fq_fields identifier id'>fq_fields</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='minus op'>-</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>'&quot; OR &quot;'</span><span class='rparen token'>)</span>
      <span class='fq_values identifier id'>fq_values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='value identifier id'>value</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='a_hash identifier id'>a_hash</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{fq_field}&quot;</span><span class='rparen token'>)</span>
          <span class='a_hash identifier id'>a_hash</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{fq_field}&quot;</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>'&quot;'</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span>
        <span class='else else kw'>else</span>
          <span class='a_hash identifier id'>a_hash</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{fq_field}&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>'&quot;'</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='a_hash identifier id'>a_hash</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_advanced_search_query_terms-instance_method">
  
    - (<tt>Object</tt>) <strong>get_advanced_search_query_terms</strong>(params) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 717</span>

<span class='def def kw'>def</span> <span class='get_advanced_search_query_terms identifier id'>get_advanced_search_query_terms</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>    
  <span class='comment val'># if using the standard query parser and have an actual query we need to modify the q param after the search results are requested to something more visually friendly</span>
  <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:qt</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;standard&quot;</span> <span class='and and kw'>and</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:q</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='string val'>&quot;collection:sirsi&quot;</span>
    <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='new_query identifier id'>new_query</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:q</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:q</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='minus op'>-</span><span class='integer val'>2</span><span class='rbrack token'>]</span>
    <span class='new_query identifier id'>new_query</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='string val'>&quot;) AND (&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot; -|- &quot;</span><span class='rparen token'>)</span>
    <span class='new_query identifier id'>new_query</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='string val'>&quot;) OR (&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot; -|- &quot;</span><span class='rparen token'>)</span>
    <span class='new_query identifier id'>new_query</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/\^\d+ OR /</span><span class='comma token'>,</span> <span class='string val'>&quot; -|- &quot;</span><span class='rparen token'>)</span>
    <span class='new_query identifier id'>new_query</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot; -|- &quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='query_string identifier id'>query_string</span><span class='bitor op'>|</span>
      <span class='fields identifier id'>fields</span> <span class='lshft op'>&lt;&lt;</span> <span class='query_string identifier id'>query_string</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='query_string identifier id'>query_string</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='regexp val'>/\(.*\)/</span><span class='rbrack token'>]</span>
      <span class='Blacklight constant id'>Blacklight</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:advanced</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='comma token'>,</span><span class='value identifier id'>value</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='eq op'>==</span> <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span>
          <span class='str identifier id'>str</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{key.to_s == &quot;description_checked&quot; ? &quot;Description-TOC&quot; : key.to_s.capitalize} = #{query[1,query.length][0,query.length-2]}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{key.to_s == &quot;description_checked&quot; ? &quot;Description-TOC&quot; : key.to_s.capitalize} = #{query[1,query.length][0,query.length-2]}&quot;</span><span class='rparen token'>)</span>
          <span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='h identifier id'>h</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='dstring node'>&quot; #{params[:op]} &quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_callnum-instance_method">
  
    - (<tt>Object</tt>) <strong>get_callnum</strong>(doc) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 575</span>

<span class='def def kw'>def</span> <span class='get_callnum identifier id'>get_callnum</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='test_hash identifier id'>test_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'item_display'</span><span class='rbrack token'>]</span>
    <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'item_display'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
      <span class='item_array identifier id'>item_array</span> <span class='assign token'>=</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>' -|- '</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='test_hash identifier id'>test_hash</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='test_hash identifier id'>test_hash</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
          <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:action</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'index'</span>
            <span class='test_hash identifier id'>test_hash</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>7</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='test_hash identifier id'>test_hash</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='test_hash identifier id'>test_hash</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>7</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='comment val'>#|Commenting out so that multiple copies show up on record view| unless test_hash[item_array[1]][item_array[2]].flatten.include?(item_array[6])</span>
          <span class='end end kw'>end</span>
        <span class='else else kw'>else</span>
          <span class='test_hash identifier id'>test_hash</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>7</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='test_hash identifier id'>test_hash</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='item_array identifier id'>item_array</span><span class='lbrack token'>[</span><span class='integer val'>7</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='test_hash identifier id'>test_hash</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_data_with_label-instance_method">
  
    - (<tt>Object</tt>) <strong>get_data_with_label</strong>(doc, label, field_string, opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate a dt/dd pair given a Solr field If you provide a :default value in
the opts hash,  then when the solr field is empty, the default value will
be used. If you don&#8217;t provide a default value, this method will not
generate html when the field is empty.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 136</span>

<span class='def def kw'>def</span> <span class='get_data_with_label identifier id'>get_data_with_label</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span> <span class='label identifier id'>label</span><span class='comma token'>,</span> <span class='field_string identifier id'>field_string</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:default</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='field_string identifier id'>field_string</span><span class='rbrack token'>]</span>
    <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='field_string identifier id'>field_string</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:default</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='field_string identifier id'>field_string</span><span class='rbrack token'>]</span>
    <span class='field identifier id'>field</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='field_string identifier id'>field_string</span><span class='rbrack token'>]</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;&lt;dt&gt;#{label}&lt;/dt&gt;&lt;dd&gt;&quot;</span>
    <span class='if if kw'>if</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
        <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
          <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{h(l)}&quot;</span>
          <span class='if if kw'>if</span> <span class='l identifier id'>l</span> <span class='neq op'>!=</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='rparen token'>)</span>
            <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='comment val'>#Does the field have a vernacular equivalent? </span>
    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;vern_#{field_string}&quot;</span><span class='rbrack token'>]</span>
      <span class='vern_field identifier id'>vern_field</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;vern_#{field_string}&quot;</span><span class='rbrack token'>]</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>
      <span class='if if kw'>if</span> <span class='vern_field identifier id'>vern_field</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
        <span class='vern_field identifier id'>vern_field</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
          <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{h(l)}&quot;</span>
          <span class='if if kw'>if</span> <span class='l identifier id'>l</span> <span class='neq op'>!=</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='vern_field identifier id'>vern_field</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='rparen token'>)</span>
            <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='vern_field identifier id'>vern_field</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
    <span class='text identifier id'>text</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_data_with_label_from_marc-instance_method">
  
    - (<tt>Object</tt>) <strong>get_data_with_label_from_marc</strong>(doc, label, field, sFields = []) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
generate an dt/dd pair given a marc field
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 174</span>

<span class='def def kw'>def</span> <span class='get_data_with_label_from_marc identifier id'>get_data_with_label_from_marc</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='label identifier id'>label</span><span class='comma token'>,</span><span class='field identifier id'>field</span><span class='comma token'>,</span><span class='sFields identifier id'>sFields</span><span class='assign token'>=</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='field identifier id'>field</span><span class='rbrack token'>]</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;&lt;dt&gt;#{label}&lt;/dt&gt;&lt;dd&gt;&quot;</span>
    <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='sFields identifier id'>sFields</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='sFields identifier id'>sFields</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{h(sl.value)} &quot;</span> <span class='colon op'>:</span> <span class='string val'>&quot;&quot;</span><span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='temp_text identifier id'>temp_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
      <span class='comment val'># get_vern method should be here? In each loop below? After?</span>
      <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='string val'>'w'</span><span class='comma token'>,</span><span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>'5'</span><span class='comma token'>,</span> <span class='string val'>'6'</span><span class='comma token'>,</span> <span class='string val'>'8'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='temp_text identifier id'>temp_text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{sl.value} &quot;</span><span class='rbrace token'>}</span>
      <span class='vernacular identifier id'>vernacular</span> <span class='assign token'>=</span> <span class='get_vernacular identifier id'>get_vernacular</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='l identifier id'>l</span><span class='rparen token'>)</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='temp_text identifier id'>temp_text</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
      <span class='vernacular identifier id'>vernacular</span> <span class='assign token'>=</span> <span class='get_vernacular identifier id'>get_vernacular</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='l identifier id'>l</span><span class='rparen token'>)</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;&lt;br/&gt;#{vernacular}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='vernacular identifier id'>vernacular</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='l identifier id'>l</span> <span class='eq op'>==</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
    <span class='text identifier id'>text</span>
  <span class='else else kw'>else</span>
    
    <span class='comment val'># The below if statement is attempting to find unmatched vernacular fields that match the supplied field string</span>
    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'880'</span><span class='rbrack token'>]</span>
      <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'880'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;//r&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>&quot;00&quot;</span> <span class='and and kw'>and</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='field identifier id'>field</span>
          <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;&lt;dt&gt;#{label}&lt;/dt&gt;&lt;dd&gt;&quot;</span>
            <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='string val'>'w'</span><span class='comma token'>,</span><span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>'5'</span><span class='comma token'>,</span> <span class='string val'>'6'</span><span class='comma token'>,</span> <span class='string val'>'8'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{sl.value} &quot;</span><span class='rbrace token'>}</span>
          <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='text identifier id'>text</span>
    <span class='end end kw'>end</span>
    
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_facet_tag_cloud-instance_method">
  
    - (<tt>Object</tt>) <strong>get_facet_tag_cloud</strong>(facet, response) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 598</span>

<span class='def def kw'>def</span> <span class='get_facet_tag_cloud identifier id'>get_facet_tag_cloud</span><span class='lparen token'>(</span><span class='facet identifier id'>facet</span><span class='comma token'>,</span><span class='response identifier id'>response</span><span class='rparen token'>)</span>
  <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='display_facet identifier id'>display_facet</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='facets identifier id'>facets</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='eq op'>==</span> <span class='facet identifier id'>facet</span> <span class='rbrace token'>}</span>
  <span class='facet_arr identifier id'>facet_arr</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='items identifier id'>items</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span> 
    <span class='facet_arr identifier id'>facet_arr</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='hits identifier id'>hits</span><span class='comma token'>,</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='facet_arr identifier id'>facet_arr</span> <span class='assign token'>=</span> <span class='facet_arr identifier id'>facet_arr</span><span class='dot token'>.</span><span class='sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span><span class='rand identifier id'>rand</span><span class='rbrace token'>}</span>
  <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;&lt;div class='cloud_div' id='cloud_#{facet}'&gt;&quot;</span>
  <span class='facet_arr identifier id'>facet_arr</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='gt op'>&gt;</span> <span class='integer val'>500000</span>
      <span class='comment val'>#font_size = &quot;3&quot;</span>
      <span class='font_size identifier id'>font_size</span> <span class='assign token'>=</span> <span class='string val'>&quot;jumbo&quot;</span>
    <span class='elsif elsif kw'>elsif</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='gt op'>&gt;</span> <span class='integer val'>100000</span>
      <span class='comment val'>#font_size = &quot;2.2&quot;</span>
      <span class='font_size identifier id'>font_size</span> <span class='assign token'>=</span> <span class='string val'>&quot;large&quot;</span>
    <span class='elsif elsif kw'>elsif</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='gt op'>&gt;</span> <span class='integer val'>75000</span>
      <span class='comment val'>#font_size = &quot;1.8&quot;</span>
      <span class='font_size identifier id'>font_size</span> <span class='assign token'>=</span> <span class='string val'>&quot;medium&quot;</span>
    <span class='elsif elsif kw'>elsif</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='gt op'>&gt;</span> <span class='integer val'>50000</span>
      <span class='comment val'>#font_size = &quot;1.4&quot;</span>
      <span class='font_size identifier id'>font_size</span> <span class='assign token'>=</span> <span class='string val'>&quot;small&quot;</span>
    <span class='else else kw'>else</span>
      <span class='comment val'>#font_size = &quot;1&quot;</span>
      <span class='font_size identifier id'>font_size</span> <span class='assign token'>=</span> <span class='string val'>&quot;tiny&quot;</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='facet identifier id'>facet</span> <span class='eq op'>==</span> <span class='string val'>'building_facet'</span> <span class='and and kw'>and</span> <span class='translate_lib identifier id'>translate_lib</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='translate_lib identifier id'>translate_lib</span><span class='lbrack token'>[</span><span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
    <span class='else else kw'>else</span>
      <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span>  <span class='dstring node'>&quot; &lt;span class='tag_cloud #{font_size}'&gt;#{link_to h(value), add_facet_params(facet, l[1])}&lt;/span&gt; &quot;</span>
  <span class='end end kw'>end</span>
  <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/div&gt;&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_nearby_items-instance_method">
  
    - (<tt>Object</tt>) <strong>get_nearby_items</strong>(document, response, how_many) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate display text for &#8220;nearby&#8221; selections according to call
number
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 814</span>

<span class='def def kw'>def</span> <span class='get_nearby_items identifier id'>get_nearby_items</span><span class='lparen token'>(</span><span class='document identifier id'>document</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='comma token'>,</span> <span class='how_many identifier id'>how_many</span><span class='rparen token'>)</span>
  <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;ul id='nearby_objects'&gt;&quot;</span>

<span class='comment val'># TODO:  how choose if there are multiple call numbers for this document?</span>
<span class='comment val'>#   1.  VALID call numbers only</span>
<span class='comment val'>#   2.  if only one, use it</span>
<span class='comment val'>#   3.  if only one LC, use it</span>
<span class='comment val'>#   4.  if multiple LC, do someting</span>
<span class='comment val'>#   5.  if no LC, do something</span>
  
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='document identifier id'>document</span><span class='lbrack token'>[</span><span class='symbol val'>:callnum_sort</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
<span class='comment val'>=begin    
    num = document[:callnum_sort].length
    if num == 1
      this_item_shelfkey = document[:callnum_sort][0].downcase
    elsif 
      # only one LC, use it
    elsif
      # mult LC, use ... one of them?
    else
      # no LC ... do something
      
    end
=end
</span>


<span class='comment val'>#puts('DEBUG: document has callnum_sort ' + document[:callnum_sort].to_s)</span>
    <span class='this_item_shelfkey identifier id'>this_item_shelfkey</span> <span class='assign token'>=</span> <span class='document identifier id'>document</span><span class='lbrack token'>[</span><span class='symbol val'>:callnum_sort</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>
<span class='comment val'>#      this_item_reverse_shelfkey = reverse_alphanum(this_item_shelfkey)</span>
<span class='comment val'># FIXME:  don't have the right conversion yet ..</span>
    <span class='this_item_reverse_shelfkey identifier id'>this_item_reverse_shelfkey</span> <span class='assign token'>=</span> <span class='document identifier id'>document</span><span class='lbrack token'>[</span><span class='symbol val'>:callnum_reverse_sort</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span>

<span class='comment val'># TODO: need to take all the returned &lt;li&gt; and sort them by shelfkey, then by title, then by author</span>

    <span class='comment val'># get preceding bookspines</span>
    
    <span class='comment val'># terms is array of one element hashes with key=term and value=count</span>
    <span class='terms_array identifier id'>terms_array</span> <span class='assign token'>=</span> <span class='get_next_terms identifier id'>get_next_terms</span><span class='lparen token'>(</span><span class='this_item_reverse_shelfkey identifier id'>this_item_reverse_shelfkey</span><span class='comma token'>,</span> <span class='string val'>&quot;callnum_reverse_sort&quot;</span><span class='comma token'>,</span> <span class='how_many identifier id'>how_many</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span>
    <span class='reverse_shelfkeys_b4 identifier id'>reverse_shelfkeys_b4</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='num_docs identifier id'>num_docs</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
<span class='puts identifier id'>puts</span> <span class='string val'>&quot;num rev terms is &quot;</span> <span class='plus op'>+</span> <span class='terms_array identifier id'>terms_array</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='terms_array identifier id'>terms_array</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='term_hash identifier id'>term_hash</span><span class='bitor op'>|</span>
      <span class='reverse_shelfkeys_b4 identifier id'>reverse_shelfkeys_b4</span> <span class='lshft op'>&lt;&lt;</span> <span class='term_hash identifier id'>term_hash</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='term_hash identifier id'>term_hash</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='this_item_reverse_shelfkey identifier id'>this_item_reverse_shelfkey</span>
      <span class='num_docs identifier id'>num_docs</span> <span class='assign token'>=</span> <span class='num_docs identifier id'>num_docs</span> <span class='plus op'>+</span> <span class='term_hash identifier id'>term_hash</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='rbrace token'>}</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='get_spines_from_field identifier id'>get_spines_from_field</span><span class='lparen token'>(</span><span class='reverse_shelfkeys_b4 identifier id'>reverse_shelfkeys_b4</span><span class='comma token'>,</span> <span class='string val'>&quot;callnum_reverse_sort&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='join identifier id'>join</span>

<span class='comment val'>=begin          
    #  preceding shelfkeys are in the reverse order of what we need to display -
    #   they are returned as closest, next closest, ... , furthest
    #   but b/c they are displayed BEFORE the current result, they 
    #   need to be ordered furthest to closest
    # also, don't display THIS document's stuff yet.
#      reverse_shelfkeys_b4.reverse_each do |r_shelfkey|
    reverse_shelfkeys_b4.each do |r_shelfkey|
      if r_shelfkey != reverse_shelfkeys_b4.first
#          text &lt;&lt; get_spines_from_field(reverse_shelfkeys_b4, &quot;callnum_reverse_sort&quot;).join
        text &lt;&lt; get_spines_from_field([r_shelfkey], &quot;callnum_reverse_sort&quot;).join
      end
    end
=end
</span>

  
    <span class='comment val'># display spine for THIS doc's shelfkey</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>
    <span class='if if kw'>if</span> <span class='terms_array identifier id'>terms_array</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
      <span class='comment val'># orig document is only instance of its shelfkey</span>
      <span class='spines identifier id'>spines</span> <span class='assign token'>=</span> <span class='get_spines_from_doc identifier id'>get_spines_from_doc</span><span class='lparen token'>(</span><span class='document identifier id'>document</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='this_item_shelfkey identifier id'>this_item_shelfkey</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='unless unless kw'>unless</span> <span class='spines identifier id'>spines</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
        <span class='spines identifier id'>spines</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='spine identifier id'>spine</span><span class='bitor op'>|</span>  
          <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='spine identifier id'>spine</span> <span class='unless unless_mod kw'>unless</span> <span class='text identifier id'>text</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='spine identifier id'>spine</span><span class='rparen token'>)</span>
        <span class='rbrace token'>}</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='get_spines_from_field identifier id'>get_spines_from_field</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='this_item_shelfkey identifier id'>this_item_shelfkey</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='string val'>&quot;callnum_sort&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
    <span class='end end kw'>end</span>      
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>

    <span class='comment val'># get following bookspines</span>
    <span class='terms_array identifier id'>terms_array</span> <span class='assign token'>=</span> <span class='get_next_terms identifier id'>get_next_terms</span><span class='lparen token'>(</span><span class='this_item_shelfkey identifier id'>this_item_shelfkey</span><span class='comma token'>,</span> <span class='string val'>&quot;callnum_sort&quot;</span><span class='comma token'>,</span> <span class='how_many identifier id'>how_many</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span>
    <span class='shelfkeys_after identifier id'>shelfkeys_after</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='num_docs identifier id'>num_docs</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
<span class='puts identifier id'>puts</span> <span class='string val'>&quot;num terms is &quot;</span> <span class='plus op'>+</span> <span class='terms_array identifier id'>terms_array</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='terms_array identifier id'>terms_array</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='term_hash identifier id'>term_hash</span><span class='bitor op'>|</span>  
      <span class='shelfkeys_after identifier id'>shelfkeys_after</span> <span class='lshft op'>&lt;&lt;</span> <span class='term_hash identifier id'>term_hash</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='term_hash identifier id'>term_hash</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='this_item_shelfkey identifier id'>this_item_shelfkey</span>
      <span class='num_docs identifier id'>num_docs</span> <span class='assign token'>=</span> <span class='num_docs identifier id'>num_docs</span> <span class='plus op'>+</span> <span class='term_hash identifier id'>term_hash</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='rbrace token'>}</span>
    
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='get_spines_from_field identifier id'>get_spines_from_field</span><span class='lparen token'>(</span><span class='shelfkeys_after identifier id'>shelfkeys_after</span><span class='comma token'>,</span> <span class='string val'>&quot;callnum_sort&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
    
<span class='comment val'>=begin      
    shelfkeys_after.each do |shelfkey|
      if shelfkey != shelfkeys_after.first
#          text &lt;&lt; get_spines_from_field(shelfkeys_after, &quot;callnum_sort&quot;).join
        text &lt;&lt; get_spines_from_field(shelfkey[0], &quot;callnum_sort&quot;).join
      end
    end
=end
</span>

  <span class='end end kw'>end</span>
  
  <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/ul&gt;&quot;</span>
  <span class='return return kw'>return</span> <span class='text identifier id'>text</span> <span class='unless unless_mod kw'>unless</span> <span class='text identifier id'>text</span> <span class='eq op'>==</span> <span class='string val'>&quot;&lt;ul id='nearby_objects'&gt;&lt;br/&gt;&lt;br/&gt;&lt;/ul&gt;&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_refine_facet-instance_method">
  
    - (<tt>Object</tt>) <strong>get_refine_facet</strong>(solr_fname, response) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
given the solr field name of a <b>refinement</b> facet (e.g.
lc_alpha_facet), return a string containing appropriate html to display the
given facet heading and its values
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 637</span>

<span class='def def kw'>def</span> <span class='get_refine_facet identifier id'>get_refine_facet</span><span class='lparen token'>(</span><span class='solr_fname identifier id'>solr_fname</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='rparen token'>)</span>
  <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='display_facet identifier id'>display_facet</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='facets identifier id'>facets</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='eq op'>==</span> <span class='solr_fname identifier id'>solr_fname</span><span class='rbrace token'>}</span> 
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='items identifier id'>items</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='items identifier id'>items</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;li&gt;&quot;</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot; &lt;h3 class='facet_selected'&gt;&quot;</span> <span class='plus op'>+</span> <span class='facet_field_labels identifier id'>facet_field_labels</span><span class='lbrack token'>[</span><span class='solr_fname identifier id'>solr_fname</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='string val'>&quot;&lt;/h3&gt;&quot;</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot; &lt;ul&gt;&quot;</span>
    <span class='item_count identifier id'>item_count</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='items identifier id'>items</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='facet_in_params? fid id'>facet_in_params?</span> <span class='solr_fname identifier id'>solr_fname</span><span class='comma token'>,</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='value identifier id'>value</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;li&gt;&quot;</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;span class='selected'&gt;&quot;</span> <span class='plus op'>+</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='item identifier id'>item</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>&quot; (&quot;</span> <span class='plus op'>+</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='plus op'>+</span> <span class='string val'>&quot;)&lt;/span&gt;&quot;</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;[#{link_to 'remove', remove_facet_params(solr_fname, item.value), :class=&gt;'remove'}]&quot;</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/li&gt;&quot;</span>
        <span class='comment val'># accommodate further call number levels</span>
        <span class='case case kw'>case</span> <span class='solr_fname identifier id'>solr_fname</span>
          <span class='when when kw'>when</span> <span class='string val'>&quot;lc_alpha_facet&quot;</span>
            <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='get_refine_facet identifier id'>get_refine_facet</span><span class='lparen token'>(</span><span class='string val'>&quot;lc_b4cutter_facet&quot;</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='rparen token'>)</span>
          <span class='when when kw'>when</span> <span class='string val'>&quot;dewey_2digit_facet&quot;</span>
            <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='get_refine_facet identifier id'>get_refine_facet</span><span class='lparen token'>(</span><span class='string val'>&quot;dewey_b4cutter_facet&quot;</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='rparen token'>)</span>
          <span class='when when kw'>when</span> <span class='string val'>&quot;dewey_1digit_facet&quot;</span>
            <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='get_refine_facet identifier id'>get_refine_facet</span><span class='lparen token'>(</span><span class='string val'>&quot;dewey_2digit_facet&quot;</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='comment val'># display the value as a link unless it is at the peer level of a selected call number facet -%&gt;</span>
        <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span> <span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^(lc_|dewey_|gov_)/i</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='params_facet_has_value? fid id'>params_facet_has_value?</span><span class='lparen token'>(</span><span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='rparen token'>)</span> 
          <span class='if if kw'>if</span> <span class='item_count identifier id'>item_count</span> <span class='gt op'>&gt;</span> <span class='integer val'>4</span>
            <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;   &lt;li class=\&quot;more\&quot;&gt;&quot;</span>
          <span class='else else kw'>else</span>
            <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;   &lt;li&gt;&quot;</span>
          <span class='end end kw'>end</span>
          <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:qt</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'standard'</span>
            <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;     #{h(item.value)} (&quot;</span> <span class='plus op'>+</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='plus op'>+</span> <span class='string val'>&quot;)&quot;</span>
          <span class='else else kw'>else</span>
            <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;     #{link_to h(item.value), add_facet_params(solr_fname, item.value)} (&quot;</span> <span class='plus op'>+</span> <span class='item identifier id'>item</span><span class='dot token'>.</span><span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='plus op'>+</span> <span class='string val'>&quot;)&quot;</span>
          <span class='end end kw'>end</span>
          <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;   &lt;/li&gt;&quot;</span>
          <span class='item_count identifier id'>item_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='items identifier id'>items</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>5</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span> <span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^(lc_|dewey_|gov_)/i</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='params_facet_has_value? fid id'>params_facet_has_value?</span><span class='lparen token'>(</span><span class='display_facet identifier id'>display_facet</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='rparen token'>)</span> 
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;li class='more_li'&gt;&lt;a href='' class='more_link' alt='more' #{home_facet_field_labels[solr_fname]}&gt;more...&lt;/a&gt;&lt;/li&gt;&quot;</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;li class='less_li' style='display:none;'&gt;&lt;a href='' class='more_link' alt='less' #{home_facet_field_labels[solr_fname]}&gt;less...&lt;/a&gt;&lt;/li&gt;&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot; &lt;/ul&gt;&quot;</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/li&gt;&quot;</span>
  <span class='end end kw'>end</span> <span class='comment val'># have facet to display</span>
  <span class='text identifier id'>text</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_relevance_bar-instance_method">
  
    - (<tt>Object</tt>) <strong>get_relevance_bar</strong>(score, label) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Genrate dt/dd with a relevance
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 115</span>

<span class='def def kw'>def</span> <span class='get_relevance_bar identifier id'>get_relevance_bar</span><span class='lparen token'>(</span><span class='score identifier id'>score</span><span class='comma token'>,</span><span class='label identifier id'>label</span><span class='rparen token'>)</span>
  <span class='score_mod identifier id'>score_mod</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='score identifier id'>score</span> <span class='mult op'>*</span> <span class='integer val'>9</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='score_mod identifier id'>score_mod</span> <span class='gt op'>&gt;</span> <span class='integer val'>100</span>
    <span class='score_mod identifier id'>score_mod</span> <span class='assign token'>=</span> <span class='integer val'>100</span>
  <span class='elsif elsif kw'>elsif</span> <span class='score_mod identifier id'>score_mod</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
    <span class='score_mod identifier id'>score_mod</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='score identifier id'>score</span> <span class='mult op'>*</span> <span class='integer val'>9</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='text identifier id'>text</span> <span class='assign token'>=</span>  <span class='dstring node'>&quot;&lt;dt&gt;#{label}&lt;/dt&gt;&quot;</span>
  <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;dd&gt;&quot;</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;div class='relevance_container'&gt;&quot;</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;&lt;span&gt;#{score_mod}%&lt;/span&gt;&quot;</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;&lt;div class='relevance_bar' style='width:#{score_mod}%'&gt;&quot;</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/div&gt;&quot;</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/div&gt;&quot;</span>
  <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_search_breadcrumb_terms-instance_method">
  
    - (<tt>Object</tt>) <strong>get_search_breadcrumb_terms</strong>(q_param) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 700</span>

<span class='def def kw'>def</span> <span class='get_search_breadcrumb_terms identifier id'>get_search_breadcrumb_terms</span><span class='lparen token'>(</span><span class='q_param identifier id'>q_param</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='q_param identifier id'>q_param</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/&quot;([^&quot;\r\n]*)&quot;/</span><span class='rparen token'>)</span>
    <span class='q_arr identifier id'>q_arr</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='old_q identifier id'>old_q</span> <span class='assign token'>=</span> <span class='q_param identifier id'>q_param</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='q_param identifier id'>q_param</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/&quot;([^&quot;\r\n]*)&quot;/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span> <span class='q_arr identifier id'>q_arr</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;\&quot;#{h(t)}\&quot;&quot;</span><span class='rbrace token'>}</span>
    <span class='q_arr identifier id'>q_arr</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
      <span class='old_q identifier id'>old_q</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='l identifier id'>l</span><span class='comma token'>,</span><span class='string val'>''</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='unless unless kw'>unless</span> <span class='old_q identifier id'>old_q</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
      <span class='old_q identifier id'>old_q</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='q identifier id'>q</span><span class='bitor op'>|</span> <span class='q_arr identifier id'>q_arr</span> <span class='lshft op'>&lt;&lt;</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='q_arr identifier id'>q_arr</span>
  <span class='else else kw'>else</span>
     <span class='q_arr identifier id'>q_arr</span> <span class='assign token'>=</span> <span class='q_param identifier id'>q_param</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_subjects-instance_method">
  
    - (<tt>Object</tt>) <strong>get_subjects</strong>(doc) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate hierarchical structure of subject headings from marc
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 423</span>

<span class='def def kw'>def</span> <span class='get_subjects identifier id'>get_subjects</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;ul id='related_subjects'&gt;&quot;</span>
  <span class='subs identifier id'>subs</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>'600'</span><span class='comma token'>,</span><span class='string val'>'610'</span><span class='comma token'>,</span><span class='string val'>'611'</span><span class='comma token'>,</span><span class='string val'>'630'</span><span class='comma token'>,</span><span class='string val'>'650'</span><span class='comma token'>,</span><span class='string val'>'651'</span><span class='comma token'>,</span><span class='string val'>'653'</span><span class='comma token'>,</span><span class='string val'>'654'</span><span class='comma token'>,</span><span class='string val'>'655'</span><span class='comma token'>,</span><span class='string val'>'656'</span><span class='comma token'>,</span><span class='string val'>'657'</span><span class='comma token'>,</span><span class='string val'>'658'</span><span class='comma token'>,</span><span class='string val'>'690'</span><span class='comma token'>,</span><span class='string val'>'691'</span><span class='comma token'>,</span><span class='string val'>'693'</span><span class='comma token'>,</span><span class='string val'>'696'</span><span class='comma token'>,</span> <span class='string val'>'697'</span><span class='comma token'>,</span><span class='string val'>'698'</span><span class='comma token'>,</span><span class='string val'>'699'</span><span class='rbrack token'>]</span>
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='subs identifier id'>subs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span>
      <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='s identifier id'>s</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
        <span class='multi_a identifier id'>multi_a</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
        <span class='temp_data_array identifier id'>temp_data_array</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
        <span class='temp_subs_text identifier id'>temp_subs_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
        <span class='temp_xyv_array identifier id'>temp_xyv_array</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
        <span class='unless unless kw'>unless</span> <span class='lparen token'>(</span><span class='s identifier id'>s</span> <span class='eq op'>==</span> <span class='string val'>&quot;690&quot;</span> <span class='and and kw'>and</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'a'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;collection&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sf identifier id'>sf</span><span class='bitor op'>|</span> 
            <span class='unless unless kw'>unless</span> <span class='lbrack token'>[</span><span class='string val'>'w'</span><span class='comma token'>,</span><span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>'1'</span><span class='comma token'>,</span> <span class='string val'>'2'</span><span class='comma token'>,</span> <span class='string val'>'3'</span><span class='comma token'>,</span> <span class='string val'>'4'</span><span class='comma token'>,</span> <span class='string val'>'5'</span><span class='comma token'>,</span> <span class='string val'>'6'</span><span class='comma token'>,</span> <span class='string val'>'7'</span><span class='comma token'>,</span> <span class='string val'>'8'</span><span class='comma token'>,</span> <span class='string val'>'9'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span> 
              <span class='if if kw'>if</span> <span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;a&quot;</span>
                <span class='multi_a identifier id'>multi_a</span> <span class='lshft op'>&lt;&lt;</span> <span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='unless unless_mod kw'>unless</span> <span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;a&quot;</span> <span class='and and kw'>and</span> <span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;%&quot;</span>
              <span class='end end kw'>end</span>
              <span class='if if kw'>if</span> <span class='lbrack token'>[</span><span class='string val'>&quot;v&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;x&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;y&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;z&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span>
                <span class='temp_xyv_array identifier id'>temp_xyv_array</span> <span class='lshft op'>&lt;&lt;</span> <span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='value identifier id'>value</span>
              <span class='else else kw'>else</span>
                <span class='temp_subs_text identifier id'>temp_subs_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{sf.value} &quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;a&quot;</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;a&quot;</span> <span class='and and kw'>and</span> <span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;%&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
              <span class='end end kw'>end</span>
            <span class='end end kw'>end</span>
          <span class='rbrace token'>}</span>
          <span class='if if kw'>if</span> <span class='multi_a identifier id'>multi_a</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
            <span class='multi_a identifier id'>multi_a</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span>
              <span class='data identifier id'>data</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span>
            <span class='end end kw'>end</span>
          <span class='elsif elsif kw'>elsif</span> <span class='multi_a identifier id'>multi_a</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
            <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='multi_a identifier id'>multi_a</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot; &quot;</span> <span class='lshft op'>&lt;&lt;</span> <span class='temp_subs_text identifier id'>temp_subs_text</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='temp_subs_text identifier id'>temp_subs_text</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span> <span class='and and kw'>and</span> <span class='multi_a identifier id'>multi_a</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rparen token'>)</span>
            <span class='temp_data_array identifier id'>temp_data_array</span> <span class='lshft op'>&lt;&lt;</span> <span class='str identifier id'>str</span>
          <span class='else else kw'>else</span>
            <span class='temp_data_array identifier id'>temp_data_array</span> <span class='lshft op'>&lt;&lt;</span> <span class='temp_subs_text identifier id'>temp_subs_text</span> <span class='unless unless_mod kw'>unless</span> <span class='temp_subs_text identifier id'>temp_subs_text</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
          <span class='end end kw'>end</span>
          <span class='temp_data_array identifier id'>temp_data_array</span><span class='dot token'>.</span><span class='concat identifier id'>concat</span><span class='lparen token'>(</span><span class='temp_xyv_array identifier id'>temp_xyv_array</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='temp_xyv_array identifier id'>temp_xyv_array</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
          <span class='data identifier id'>data</span> <span class='lshft op'>&lt;&lt;</span> <span class='temp_data_array identifier id'>temp_data_array</span> <span class='unless unless_mod kw'>unless</span> <span class='temp_data_array identifier id'>temp_data_array</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='i identifier id'>i</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
 
  <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fields identifier id'>fields</span><span class='bitor op'>|</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;li&gt;&quot;</span>
    <span class='link_text identifier id'>link_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
    <span class='title_text identifier id'>title_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;Search: &quot;</span>
    <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='bitor op'>|</span>
      <span class='link_text identifier id'>link_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot; &quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='field identifier id'>field</span> <span class='eq op'>==</span> <span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
      <span class='link_text identifier id'>link_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;\&quot;#{field.strip}\&quot;&quot;</span>
      <span class='title_text identifier id'>title_text</span> <span class='lshft op'>&lt;&lt;</span>  <span class='string val'>&quot; - &quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='field identifier id'>field</span> <span class='eq op'>==</span> <span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
      <span class='title_text identifier id'>title_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{field.strip}&quot;</span>
      <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='link_to identifier id'>link_to</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'catalog'</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'index'</span><span class='comma token'>,</span> <span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='link_text identifier id'>link_text</span><span class='comma token'>,</span> <span class='symbol val'>:qt</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'search_subject'</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='symbol val'>:title</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='title_text identifier id'>title_text</span><span class='rparen token'>)</span>
      <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot; &amp;gt; &quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='field identifier id'>field</span> <span class='eq op'>==</span> <span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/li&gt;&quot;</span>
    <span class='i identifier id'>i</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>
  <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/ul&gt;&quot;</span>
  <span class='return return kw'>return</span> <span class='text identifier id'>text</span> <span class='unless unless_mod kw'>unless</span> <span class='text identifier id'>text</span> <span class='eq op'>==</span> <span class='string val'>&quot;&lt;ul id='related_subjects'&gt;&lt;/ul&gt;&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_suppl_urls-instance_method">
  
    - (<tt>Object</tt>) <strong>get_suppl_urls</strong>(doc) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 529</span>

<span class='def def kw'>def</span> <span class='get_suppl_urls identifier id'>get_suppl_urls</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'url_fulltext'</span><span class='rbrack token'>]</span>
    <span class='urls identifier id'>urls</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'url_fulltext'</span><span class='rbrack token'>]</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;dt&gt;Online:&lt;/dt&gt;&lt;dd&gt;&quot;</span>
    <span class='comment val'>#urls.each do |url|</span>
      <span class='fixed_url identifier id'>fixed_url</span> <span class='assign token'>=</span> <span class='urls identifier id'>urls</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;^&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
      <span class='url_host identifier id'>url_host</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='fixed_url identifier id'>fixed_url</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='host identifier id'>host</span>
      <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;a href='#{urls[0].strip}'&gt;#{url_host}&lt;/a&gt;&quot;</span>
      <span class='if if kw'>if</span> <span class='urls identifier id'>urls</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; + #{pluralize(urls.length - 1, 'more source')}&quot;</span>
      <span class='end end kw'>end</span>
    <span class='comment val'>#end</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
  <span class='end end kw'>end</span>
  <span class='text identifier id'>text</span>
  
<span class='rescue rescue kw'>rescue</span> <span class='URI constant id'>URI</span><span class='colon2 op'>::</span><span class='InvalidURIError constant id'>InvalidURIError</span>
  <span class='return return kw'>return</span> <span class='string val'>&quot;&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_toc-instance_method">
  
    - (<tt>Object</tt>) <strong>get_toc</strong>(doc) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate dt/dd pair with an unordered list from the table of contents (IE
marc 505s)
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 260</span>

<span class='def def kw'>def</span> <span class='get_toc identifier id'>get_toc</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'505'</span><span class='rbrack token'>]</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;dt&gt;Contents:&lt;/dt&gt;&lt;dd&gt;&quot;</span>
    <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'505'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
      <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;ul class='toc'&gt;&lt;li&gt;&quot;</span>
      <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='string val'>'w'</span><span class='comma token'>,</span><span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>'5'</span><span class='comma token'>,</span> <span class='string val'>'6'</span><span class='comma token'>,</span> <span class='string val'>'8'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{sl.value.gsub(' -- ','&lt;/li&gt;&lt;li&gt;')} &quot;</span> <span class='rbrace token'>}</span>
      <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/li&gt;&lt;/ul&gt;&quot;</span>
      <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;ul class='toc'&gt;&lt;li&gt;#{get_vernacular(doc,l).gsub('--','&lt;/li&gt;&lt;li&gt;')}&lt;/li&gt;&lt;/ul&gt;&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='get_vernacular identifier id'>get_vernacular</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='l identifier id'>l</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
  <span class='else else kw'>else</span>
    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'880'</span><span class='rbrack token'>]</span>
      <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'880'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;//r&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>&quot;00&quot;</span> <span class='and and kw'>and</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;505&quot;</span>
          <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;dt&gt;Contents:&lt;/dt&gt;&lt;dd&gt;&lt;ul class='toc'&gt;&lt;li&gt;&quot;</span>
            <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='string val'>'w'</span><span class='comma token'>,</span><span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>'5'</span><span class='comma token'>,</span> <span class='string val'>'6'</span><span class='comma token'>,</span> <span class='string val'>'8'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{sl.value.gsub('--','&lt;/li&gt;&lt;li&gt;')} &quot;</span><span class='rbrace token'>}</span>
          <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/li&gt;&lt;/dd&gt;&quot;</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='text identifier id'>text</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_vernacular-instance_method">
  
    - (<tt>Object</tt>) <strong>get_vernacular</strong>(doc, field) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 550</span>

<span class='def def kw'>def</span> <span class='get_vernacular identifier id'>get_vernacular</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='field identifier id'>field</span><span class='rparen token'>)</span>
  <span class='return_text identifier id'>return_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='if if kw'>if</span> <span class='field identifier id'>field</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span>
    <span class='field_original identifier id'>field_original</span> <span class='assign token'>=</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span>
    <span class='match_original identifier id'>match_original</span> <span class='assign token'>=</span> <span class='field identifier id'>field</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
    <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'880'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span>
        <span class='field_880 identifier id'>field_880</span> <span class='assign token'>=</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
        <span class='match_880 identifier id'>match_880</span> <span class='assign token'>=</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;//r&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='match_original identifier id'>match_original</span> <span class='eq op'>==</span> <span class='match_880 identifier id'>match_880</span> <span class='and and kw'>and</span> <span class='field_original identifier id'>field_original</span> <span class='eq op'>==</span> <span class='field_880 identifier id'>field_880</span>
          <span class='return_text identifier id'>return_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
          <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span>
            <span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> 
            <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='lbrack token'>[</span><span class='string val'>'w'</span><span class='comma token'>,</span><span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>'5'</span><span class='comma token'>,</span> <span class='string val'>'6'</span><span class='comma token'>,</span> <span class='string val'>'8'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span>
              <span class='return_text identifier id'>return_text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{sl.value} &quot;</span>
            <span class='end end kw'>end</span>
          <span class='rbrace token'>}</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='return_text identifier id'>return_text</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='return_text identifier id'>return_text</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="home_facet_field_labels-instance_method">
  
    - (<tt>Object</tt>) <strong>home_facet_field_labels</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 15</span>

<span class='def def kw'>def</span> <span class='home_facet_field_labels identifier id'>home_facet_field_labels</span>
  <span class='Blacklight constant id'>Blacklight</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:home_facet</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:labels</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="home_facet_field_names-instance_method">
  
    - (<tt>Object</tt>) <strong>home_facet_field_names</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 12</span>

<span class='def def kw'>def</span> <span class='home_facet_field_names identifier id'>home_facet_field_names</span>
  <span class='Blacklight constant id'>Blacklight</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:home_facet</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:solr</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="link_back_to_catalog-instance_method">
  
    - (<tt>Object</tt>) <strong>link_back_to_catalog</strong>(opts = {:label=&gt;'Back to Search'}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
link_back_to_catalog(:label=>&#8217;Back to Search&#8217;) Create a link
back to the index screen, keeping the user&#8217;s facet, query and paging
choices intact by using session.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 52</span>

<span class='def def kw'>def</span> <span class='link_back_to_catalog identifier id'>link_back_to_catalog</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='symbol val'>:label=</span><span class='gt op'>&gt;</span><span class='string val'>'Back to Search'</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='query_params identifier id'>query_params</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:search</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='query_params identifier id'>query_params</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:counter</span>
  <span class='query_params identifier id'>query_params</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:total</span>
  <span class='link_url identifier id'>link_url</span> <span class='assign token'>=</span> <span class='root_path identifier id'>root_path</span><span class='lparen token'>(</span><span class='query_params identifier id'>query_params</span><span class='rparen token'>)</span>
  <span class='link_to identifier id'>link_to</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:label</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='link_url identifier id'>link_url</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="link_to_contributor_from_marc-instance_method">
  
    - (<tt>Object</tt>) <strong>link_to_contributor_from_marc</strong>(doc) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate dt/dd pair of contributors with translations
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 323</span>

<span class='def def kw'>def</span> <span class='link_to_contributor_from_marc identifier id'>link_to_contributor_from_marc</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;dt&gt;Contributor:&lt;/dt&gt;&lt;dd&gt;&quot;</span>
  <span class='lbrack token'>[</span><span class='string val'>'700'</span><span class='comma token'>,</span> <span class='string val'>'710'</span><span class='comma token'>,</span> <span class='string val'>'711'</span><span class='comma token'>,</span> <span class='string val'>'720'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='field identifier id'>field</span><span class='rbrack token'>]</span>
      <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
        <span class='link_text identifier id'>link_text</span> <span class='assign token'>=</span> <span class='string val'>''</span>
        <span class='relator_text identifier id'>relator_text</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
        <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>'4'</span> <span class='question op'>?</span> <span class='relator_text identifier id'>relator_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; #{relator_terms[sl.value]}&quot;</span> <span class='colon op'>:</span> <span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>'6'</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='link_text identifier id'>link_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{sl.value} &quot;</span><span class='rbrace token'>}</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='link_to identifier id'>link_to</span><span class='lparen token'>(</span><span class='link_text identifier id'>link_text</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='comma token'>,</span> <span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{link_text}\&quot;&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'catalog'</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'index'</span><span class='comma token'>,</span> <span class='symbol val'>:qt</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'search_author'</span> <span class='rparen token'>)</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='relator_text identifier id'>relator_text</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;, &quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='relator_text identifier id'>relator_text</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
        <span class='vernacular identifier id'>vernacular</span> <span class='assign token'>=</span> <span class='get_vernacular identifier id'>get_vernacular</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='l identifier id'>l</span><span class='rparen token'>)</span>
        <span class='temp_vern identifier id'>temp_vern</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;\&quot;#{vernacular}\&quot;&quot;</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;br/&gt;#{link_to vernacular, :q =&gt; temp_vern, :controller =&gt; 'catalog', :action =&gt; 'index', :qt =&gt; 'search_author'}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='vernacular identifier id'>vernacular</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'880'</span><span class='rbrack token'>]</span>
        <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'880'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
          <span class='if if kw'>if</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;//r&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>&quot;00&quot;</span> <span class='and and kw'>and</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='field identifier id'>field</span>
            <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;dt&gt;Contributor:&lt;/dt&gt;&lt;dd&gt;&quot;</span>
              <span class='link_text identifier id'>link_text</span> <span class='assign token'>=</span> <span class='string val'>''</span>
              <span class='relator_text identifier id'>relator_text</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
              <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>'4'</span> <span class='question op'>?</span> <span class='relator_text identifier id'>relator_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; #{relator_terms[sl.value]}&quot;</span> <span class='colon op'>:</span> <span class='link_text identifier id'>link_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{sl.value} &quot;</span><span class='rbrace token'>}</span>
              <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='link_to identifier id'>link_to</span><span class='lparen token'>(</span><span class='link_text identifier id'>link_text</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='comma token'>,</span><span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{link_text}\&quot;&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'index'</span><span class='comma token'>,</span> <span class='symbol val'>:qt</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'author_search'</span><span class='rparen token'>)</span>
              <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='relator_text identifier id'>relator_text</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;, &quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='relator_text identifier id'>relator_text</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
  <span class='text identifier id'>text</span> <span class='unless unless_mod kw'>unless</span> <span class='text identifier id'>text</span> <span class='eq op'>==</span> <span class='string val'>&quot;&lt;dt&gt;Contributor:&lt;/dt&gt;&lt;dd&gt;&lt;/dd&gt;&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="link_to_data_with_label-instance_method">
  
    - (<tt>Object</tt>) <strong>link_to_data_with_label</strong>(doc, label, field_string, url) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate a dt/dd pair with a link with a label given a field in the
SolrDocument
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 226</span>

<span class='def def kw'>def</span> <span class='link_to_data_with_label identifier id'>link_to_data_with_label</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='label identifier id'>label</span><span class='comma token'>,</span><span class='field_string identifier id'>field_string</span><span class='comma token'>,</span><span class='url identifier id'>url</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='field_string identifier id'>field_string</span><span class='rbrack token'>]</span>
    <span class='field identifier id'>field</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='field_string identifier id'>field_string</span><span class='rbrack token'>]</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;&lt;dt&gt;#{label}&lt;/dt&gt;&lt;dd&gt;&quot;</span>
    <span class='if if kw'>if</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
      <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='link_to identifier id'>link_to</span> <span class='l identifier id'>l</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{l}\&quot;&quot;</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='l identifier id'>l</span> <span class='neq op'>!=</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
          <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='link_to identifier id'>link_to</span> <span class='field identifier id'>field</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{field}\&quot;&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;vern_#{field_string}&quot;</span><span class='rbrack token'>]</span>
      <span class='vern_field identifier id'>vern_field</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;vern_#{field_string}&quot;</span><span class='rbrack token'>]</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>
      <span class='if if kw'>if</span> <span class='vern_field identifier id'>vern_field</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
        <span class='vern_field identifier id'>vern_field</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
          <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='link_to identifier id'>link_to</span> <span class='l identifier id'>l</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{l}\&quot;&quot;</span><span class='rparen token'>)</span>
          <span class='if if kw'>if</span> <span class='l identifier id'>l</span> <span class='neq op'>!=</span> <span class='vern_field identifier id'>vern_field</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
            <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='link_to identifier id'>link_to</span> <span class='vern_field identifier id'>vern_field</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{vern_field}\&quot;&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
    <span class='text identifier id'>text</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="link_to_data_with_label_from_marc-instance_method">
  
    - (<tt>Object</tt>) <strong>link_to_data_with_label_from_marc</strong>(doc, label, field, url, sFields = []) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate dt/dd pair with a link with a label given a marc field
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 284</span>

<span class='def def kw'>def</span> <span class='link_to_data_with_label_from_marc identifier id'>link_to_data_with_label_from_marc</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='label identifier id'>label</span><span class='comma token'>,</span><span class='field identifier id'>field</span><span class='comma token'>,</span><span class='url identifier id'>url</span><span class='comma token'>,</span><span class='sFields identifier id'>sFields</span><span class='assign token'>=</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='field identifier id'>field</span><span class='rbrack token'>]</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;&lt;dt&gt;#{label}&lt;/dt&gt;&lt;dd&gt;&quot;</span>
    <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='sFields identifier id'>sFields</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
        <span class='link_text identifier id'>link_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
        <span class='sFields identifier id'>sFields</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='sf identifier id'>sf</span><span class='bitor op'>|</span>
          <span class='if if kw'>if</span> <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='sf identifier id'>sf</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrace token'>}</span>
            <span class='link_text identifier id'>link_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{l.find{|s| s.code == sf.to_s}.value} &quot;</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='link_to identifier id'>link_to</span> <span class='link_text identifier id'>link_text</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{link_text}\&quot;&quot;</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='link_text identifier id'>link_text</span> <span class='assign token'>=</span> <span class='string val'>''</span>
        <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='string val'>'w'</span><span class='comma token'>,</span><span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>'5'</span><span class='comma token'>,</span> <span class='string val'>'6'</span><span class='comma token'>,</span> <span class='string val'>'8'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='link_text identifier id'>link_text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{sl.value} &quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>'a'</span> <span class='and and kw'>and</span> <span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;%&quot;</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='link_to identifier id'>link_to</span> <span class='link_text identifier id'>link_text</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{link_text}\&quot;&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='vernacular identifier id'>vernacular</span> <span class='assign token'>=</span> <span class='get_vernacular identifier id'>get_vernacular</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='comma token'>,</span><span class='l identifier id'>l</span><span class='rparen token'>)</span>
      <span class='temp_vern identifier id'>temp_vern</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;\&quot;#{vernacular}\&quot;&quot;</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;&lt;br/&gt;#{link_to vernacular, url.merge!(:q =&gt; temp_vern)}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='vernacular identifier id'>vernacular</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;br/&gt;&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='l identifier id'>l</span> <span class='eq op'>==</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
  <span class='else else kw'>else</span>
    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'880'</span><span class='rbrack token'>]</span>
      <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'880'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;//r&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>&quot;00&quot;</span> <span class='and and kw'>and</span> <span class='l identifier id'>l</span><span class='lbrack token'>[</span><span class='string val'>'6'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;-&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='field identifier id'>field</span>
          <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;&lt;dt&gt;#{label}&lt;/dt&gt;&lt;dd&gt;&quot;</span>
            <span class='link_text identifier id'>link_text</span> <span class='assign token'>=</span> <span class='string val'>''</span>
            <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='sl identifier id'>sl</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='string val'>'w'</span><span class='comma token'>,</span><span class='string val'>'0'</span><span class='comma token'>,</span> <span class='string val'>'5'</span><span class='comma token'>,</span> <span class='string val'>'6'</span><span class='comma token'>,</span> <span class='string val'>'8'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sl identifier id'>sl</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='link_text identifier id'>link_text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{sl.value} &quot;</span><span class='rbrace token'>}</span>
            <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='link_to identifier id'>link_to</span> <span class='link_text identifier id'>link_text</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:q</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;\&quot;#{link_text}\&quot;&quot;</span><span class='rparen token'>)</span>
          <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='text identifier id'>text</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="link_to_next_document-instance_method">
  
    - (<tt>Object</tt>) <strong>link_to_next_document</strong>(next_document) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
overriding because we need to escape the &#8216;Next >&#8217; at the
linking level
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 24</span>

<span class='def def kw'>def</span> <span class='link_to_next_document identifier id'>link_to_next_document</span><span class='lparen token'>(</span><span class='next_document identifier id'>next_document</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='next_document identifier id'>next_document</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span>
  <span class='link_to_document identifier id'>link_to_document</span> <span class='next_document identifier id'>next_document</span><span class='comma token'>,</span> <span class='symbol val'>:label=</span><span class='gt op'>&gt;</span><span class='string val'>'Next &amp;raquo;'</span><span class='comma token'>,</span> <span class='symbol val'>:counter</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:search</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:counter</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="link_to_previous_document-instance_method">
  
    - (<tt>Object</tt>) <strong>link_to_previous_document</strong>(previous_document) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
overriding because we need to escape the &#8217;< Previous&#8217; at the
linking level
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 19</span>

<span class='def def kw'>def</span> <span class='link_to_previous_document identifier id'>link_to_previous_document</span><span class='lparen token'>(</span><span class='previous_document identifier id'>previous_document</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='previous_document identifier id'>previous_document</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span>
  <span class='link_to_document identifier id'>link_to_document</span> <span class='previous_document identifier id'>previous_document</span><span class='comma token'>,</span> <span class='symbol val'>:label=</span><span class='gt op'>&gt;</span><span class='string val'>'&amp;laquo; Previous'</span><span class='comma token'>,</span> <span class='symbol val'>:counter</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:search</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:counter</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="link_to_with_data-instance_method">
  
    - (<tt>Object</tt>) <strong>link_to_with_data</strong>(*args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This is an updated <tt>link_to</tt> that allows you to pass a <tt>data</tt>
hash along with the <tt>html_options</tt> which are then written to the
generated form for non-GET requests. The key is the form element name and
the value is the value:
</p>
<pre class="code">
 <span class='link_to_with_data identifier id'>link_to_with_data</span><span class='lparen token'>(</span><span class='string val'>'Name'</span><span class='comma token'>,</span> <span class='some_path identifier id'>some_path</span><span class='lparen token'>(</span><span class='some_id identifier id'>some_id</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:method</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:post</span><span class='comma token'>,</span> <span class='symbol val'>:html</span><span class='rparen token'>)</span>
</pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 65</span>

<span class='def def kw'>def</span> <span class='link_to_with_data identifier id'>link_to_with_data</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='options identifier id'>options</span>      <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='html_options identifier id'>html_options</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='second identifier id'>second</span>
    <span class='concat identifier id'>concat</span><span class='lparen token'>(</span><span class='link_to identifier id'>link_to</span><span class='lparen token'>(</span><span class='capture identifier id'>capture</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='html_options identifier id'>html_options</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='name identifier id'>name</span>         <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='options identifier id'>options</span>      <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='second identifier id'>second</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='html_options identifier id'>html_options</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='third identifier id'>third</span>

    <span class='url identifier id'>url</span> <span class='assign token'>=</span> <span class='url_for identifier id'>url_for</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>

    <span class='if if kw'>if</span> <span class='html_options identifier id'>html_options</span>
      <span class='html_options identifier id'>html_options</span> <span class='assign token'>=</span> <span class='html_options identifier id'>html_options</span><span class='dot token'>.</span><span class='stringify_keys identifier id'>stringify_keys</span>
      <span class='href identifier id'>href</span> <span class='assign token'>=</span> <span class='html_options identifier id'>html_options</span><span class='lbrack token'>[</span><span class='string val'>'href'</span><span class='rbrack token'>]</span>
      <span class='convert_options_to_javascript_with_data! fid id'>convert_options_to_javascript_with_data!</span><span class='lparen token'>(</span><span class='html_options identifier id'>html_options</span><span class='comma token'>,</span> <span class='url identifier id'>url</span><span class='rparen token'>)</span>
      <span class='tag_options identifier id'>tag_options</span> <span class='assign token'>=</span> <span class='tag_options identifier id'>tag_options</span><span class='lparen token'>(</span><span class='html_options identifier id'>html_options</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='tag_options identifier id'>tag_options</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>

    <span class='href_attr identifier id'>href_attr</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;href=\&quot;#{url}\&quot;&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='href identifier id'>href</span>
    <span class='dstring node'>&quot;&lt;a #{href_attr}#{tag_options}&gt;#{name || url}&lt;/a&gt;&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="params_facet_has_value?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>params_facet_has_value?</strong>(field) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
true or false, depending on whether the field and a value is in params[:f]
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


691
692
693
694
695
696
697</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 691</span>

<span class='def def kw'>def</span> <span class='params_facet_has_value? fid id'>params_facet_has_value?</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:f</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:f</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='field identifier id'>field</span><span class='rbrack token'>]</span>
   <span class='notop op'>!</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:f</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='field identifier id'>field</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> 
  <span class='else else kw'>else</span>
    <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="previous_search_is_referrer?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>previous_search_is_referrer?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


762
763
764
765
766
767
768
769
770
771
772
773
774
775</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 762</span>

<span class='def def kw'>def</span> <span class='previous_search_is_referrer? fid id'>previous_search_is_referrer?</span>
  <span class='comment val'># If the referrer params are empty and there is no search history return false (User went directly to the record w/o a search session)</span>
  <span class='if if kw'>if</span> <span class='referrer_params identifier id'>referrer_params</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='and and kw'>and</span> <span class='url_back_to_catalog identifier id'>url_back_to_catalog</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='false false kw'>false</span>
  <span class='comment val'># If  the search history == the referrer params return true.</span>
  <span class='elsif elsif kw'>elsif</span> <span class='url_back_to_catalog identifier id'>url_back_to_catalog</span> <span class='eq op'>==</span> <span class='referrer_params identifier id'>referrer_params</span>
    <span class='true true kw'>true</span>
  <span class='comment val'># If the referrer includes the base URL (ie, &lt;Prev | Next&gt; links on record view) then return true</span>
  <span class='elsif elsif kw'>elsif</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='referrer identifier id'>referrer</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='url_for identifier id'>url_for</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'catalog'</span><span class='comma token'>,</span> <span class='symbol val'>:only_path</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='true true kw'>true</span>
  <span class='else else kw'>else</span>
    <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="referrer_params-instance_method">
  
    - (<tt>Object</tt>) <strong>referrer_params</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 777</span>

<span class='def def kw'>def</span> <span class='referrer_params identifier id'>referrer_params</span>
  <span class='request_params identifier id'>request_params</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='if if kw'>if</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='referrer identifier id'>referrer</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;&amp;&quot;</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='referrer identifier id'>referrer</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;?&quot;</span><span class='rparen token'>)</span> 
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='referrer identifier id'>referrer</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lbrack token'>[</span><span class='regexp val'>/\/\?.*/</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;&amp;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='paramater identifier id'>paramater</span><span class='bitor op'>|</span>
      <span class='unless unless kw'>unless</span> <span class='paramater identifier id'>paramater</span> <span class='eq op'>==</span> <span class='string val'>&quot;/?&quot;</span>
        <span class='key identifier id'>key</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='colon2 op'>::</span><span class='unescape identifier id'>unescape</span><span class='lparen token'>(</span><span class='paramater identifier id'>paramater</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;=&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/\/\?/</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span>
        <span class='key identifier id'>key</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;/?&quot;</span> <span class='question op'>?</span> <span class='key identifier id'>key</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='string val'>&quot;/?&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='colon op'>:</span> <span class='string val'>&quot;&quot;</span>
        <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='paramater identifier id'>paramater</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;=&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='paramater identifier id'>paramater</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;=&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;+&quot;</span><span class='comma token'>,</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='string val'>&quot;&quot;</span>
        <span class='if if kw'>if</span> <span class='request_params identifier id'>request_params</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
          <span class='request_params identifier id'>request_params</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='CGI constant id'>CGI</span><span class='colon2 op'>::</span><span class='unescape identifier id'>unescape</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
        <span class='else else kw'>else</span>
          <span class='request_params identifier id'>request_params</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='colon2 op'>::</span><span class='unescape identifier id'>unescape</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='request_params identifier id'>request_params</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="remove_query_params-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_query_params</strong>(value, source_params = params) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
copies the current params (or whatever is passed in as the 3rd arg) removes
the field value from params[:f] removes the field if there are no more
values in params[:f][field] removes additional params (page, id, etc..)
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 33</span>

<span class='def def kw'>def</span> <span class='remove_query_params identifier id'>remove_query_params</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='source_params identifier id'>source_params</span><span class='assign token'>=</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='source_params identifier id'>source_params</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span><span class='dot token'>.</span><span class='symbolize_keys! fid id'>symbolize_keys!</span>
  <span class='comment val'># need to dup the facet values too,</span>
  <span class='comment val'># if the values aren't dup'd, then the values</span>
  <span class='comment val'># from the session will get remove in the show view...</span>
  <span class='p identifier id'>p</span><span class='lbrack token'>[</span><span class='symbol val'>:q</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='p identifier id'>p</span><span class='lbrack token'>[</span><span class='symbol val'>:q</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:page</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:id</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:total</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:counter</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:commit</span>
  <span class='comment val'>#return p unless p[field]</span>
  <span class='p identifier id'>p</span><span class='lbrack token'>[</span><span class='symbol val'>:q</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='p identifier id'>p</span><span class='lbrack token'>[</span><span class='symbol val'>:q</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:q</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='p identifier id'>p</span><span class='lbrack token'>[</span><span class='symbol val'>:q</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
  <span class='p identifier id'>p</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="results_text-instance_method">
  
    - (<tt>Object</tt>) <strong>results_text</strong>(pp, p, result_num) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate the # - # of # results text
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 91</span>

<span class='def def kw'>def</span> <span class='results_text identifier id'>results_text</span><span class='lparen token'>(</span><span class='pp identifier id'>pp</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='comma token'>,</span> <span class='result_num identifier id'>result_num</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='pp identifier id'>pp</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='per_page identifier id'>per_page</span> <span class='assign token'>=</span> <span class='Blacklight constant id'>Blacklight</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:index</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:num_per_page</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='else else kw'>else</span>
    <span class='per_page identifier id'>per_page</span> <span class='assign token'>=</span> <span class='pp identifier id'>pp</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>     
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='start_num identifier id'>start_num</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
  <span class='else else kw'>else</span>
    <span class='start_num identifier id'>start_num</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='mult op'>*</span> <span class='per_page identifier id'>per_page</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='per_page identifier id'>per_page</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='p identifier id'>p</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='and and kw'>and</span> <span class='per_page identifier id'>per_page</span> <span class='lt op'>&lt;</span> <span class='result_num identifier id'>result_num</span>
    <span class='end_num identifier id'>end_num</span> <span class='assign token'>=</span> <span class='per_page identifier id'>per_page</span>
  <span class='elsif elsif kw'>elsif</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='per_page identifier id'>per_page</span> <span class='mult op'>*</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span> <span class='gt op'>&gt;</span> <span class='result_num identifier id'>result_num</span><span class='rparen token'>)</span>
    <span class='end_num identifier id'>end_num</span> <span class='assign token'>=</span> <span class='result_num identifier id'>result_num</span>
  <span class='else else kw'>else</span>
    <span class='end_num identifier id'>end_num</span> <span class='assign token'>=</span> <span class='per_page identifier id'>per_page</span> <span class='mult op'>*</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='end end kw'>end</span>
  <span class='dstring node'>&quot;#{start_num} - #{end_num} of &quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="show_formats-instance_method">
  
    - (<tt>Object</tt>) <strong>show_formats</strong>(field) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Generate a dt/dd pair with a comma separated list of formats given an array
of format strings
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216
217
218
219
220
221
222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 210</span>

<span class='def def kw'>def</span> <span class='show_formats identifier id'>show_formats</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='field identifier id'>field</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&lt;dt&gt;Format:&lt;/dt&gt;&lt;dd&gt;&quot;</span>
    <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='l identifier id'>l</span><span class='bitor op'>|</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;&lt;span class='iconSpan #{l.downcase.gsub(&quot; &quot;,&quot;&quot;).gsub(&quot;/&quot;,&quot;_&quot;)}'&gt;&quot;</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='h identifier id'>h</span><span class='lparen token'>(</span><span class='l identifier id'>l</span><span class='rparen token'>)</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;, &quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='l identifier id'>l</span> <span class='eq op'>==</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
      <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/span&gt;&quot;</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;&lt;/dd&gt;&quot;</span>
    <span class='text identifier id'>text</span>
  <span class='end end kw'>end</span>
  
  
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="title_change_data_from_marc-instance_method">
  
    - (<tt>Object</tt>) <strong>title_change_data_from_marc</strong>(doc) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 357</span>

<span class='def def kw'>def</span> <span class='title_change_data_from_marc identifier id'>title_change_data_from_marc</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'780'</span><span class='rbrack token'>]</span> <span class='or or kw'>or</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'785'</span><span class='rbrack token'>]</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'780'</span><span class='rbrack token'>]</span>
      <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'780'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='bitor op'>|</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;dt&gt;#{name_change_780_translations[field.indicator2]}:&lt;/dt&gt;&quot;</span>
        <span class='temp_text identifier id'>temp_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
        <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='subfield identifier id'>subfield</span><span class='bitor op'>|</span>
          <span class='if if kw'>if</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;w&quot;</span>
            <span class='nil nil kw'>nil</span>
          <span class='elsif elsif kw'>elsif</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;t&quot;</span>
            <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;\&quot;#{subfield.value}\&quot;&quot;</span>
            <span class='temp_text identifier id'>temp_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{link_to(subfield.value, params.dup.merge!(:action=&gt;'index', :qt=&gt;'search_title', :q=&gt;query))} &quot;</span>
          <span class='elsif elsif kw'>elsif</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;x&quot;</span>
            <span class='temp_text identifier id'>temp_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;(#{link_to(subfield.value, params.dup.merge!(:action=&gt;'index', :qt=&gt;'search', :q=&gt;subfield.value))}) &quot;</span>
          <span class='else else kw'>else</span>
            <span class='temp_text identifier id'>temp_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{subfield.value} &quot;</span>
          <span class='end end kw'>end</span>
        <span class='rbrace token'>}</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;dd&gt;#{temp_text}&lt;/dd&gt;&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='lbrack token'>[</span><span class='string val'>'785'</span><span class='rbrack token'>]</span>
      <span class='special_handler identifier id'>special_handler</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'785'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='indicator2 identifier id'>indicator2</span> <span class='eq op'>==</span> <span class='string val'>&quot;7&quot;</span>
          <span class='special_handler identifier id'>special_handler</span> <span class='lshft op'>&lt;&lt;</span> <span class='field identifier id'>field</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      
      <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='marc identifier id'>marc</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='string val'>'785'</span><span class='rparen token'>)</span> <span class='eqq op'>===</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='tag identifier id'>tag</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='bitor op'>|</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;dt&gt;&quot;</span>
        <span class='if if kw'>if</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='indicator2 identifier id'>indicator2</span> <span class='eq op'>==</span> <span class='string val'>&quot;7&quot;</span> <span class='and and kw'>and</span> <span class='field identifier id'>field</span> <span class='eq op'>==</span> <span class='special_handler identifier id'>special_handler</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
          <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;Merged with:&quot;</span>
        <span class='elsif elsif kw'>elsif</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='indicator2 identifier id'>indicator2</span> <span class='eq op'>==</span> <span class='string val'>&quot;7&quot;</span> <span class='and and kw'>and</span> <span class='field identifier id'>field</span> <span class='eq op'>==</span> <span class='special_handler identifier id'>special_handler</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
          <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;to form:&quot;</span>
        <span class='elsif elsif kw'>elsif</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='indicator2 identifier id'>indicator2</span> <span class='eq op'>==</span> <span class='string val'>&quot;7&quot;</span> <span class='and and kw'>and</span> <span class='field identifier id'>field</span> <span class='neq op'>!=</span> <span class='special_handler identifier id'>special_handler</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='and and kw'>and</span> <span class='field identifier id'>field</span> <span class='neq op'>!=</span> <span class='special_handler identifier id'>special_handler</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
          <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;and with:&quot;</span>
        <span class='else else kw'>else</span>
          <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{name_change_785_translations[field.indicator2]}:&quot;</span>
        <span class='end end kw'>end</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/dt&gt;&quot;</span>
        <span class='temp_text identifier id'>temp_text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
        <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='subfield identifier id'>subfield</span><span class='bitor op'>|</span>
          <span class='if if kw'>if</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;w&quot;</span>
            <span class='nil nil kw'>nil</span>
          <span class='elsif elsif kw'>elsif</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;t&quot;</span>
            <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;\&quot;#{subfield.value}\&quot;&quot;</span>
            <span class='temp_text identifier id'>temp_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{link_to(subfield.value, params.dup.merge!(:action=&gt;'index', :qt=&gt;'search_title', :q=&gt;query))} &quot;</span>
          <span class='elsif elsif kw'>elsif</span> <span class='subfield identifier id'>subfield</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='eq op'>==</span> <span class='string val'>&quot;x&quot;</span>
            <span class='temp_text identifier id'>temp_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;(#{link_to(subfield.value, params.dup.merge!(:action=&gt;'index', :qt=&gt;'search', :q=&gt;subfield.value))}) &quot;</span>
          <span class='else else kw'>else</span>
            <span class='temp_text identifier id'>temp_text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{subfield.value} &quot;</span>
          <span class='end end kw'>end</span>
        <span class='rbrace token'>}</span>
        <span class='text identifier id'>text</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;dd&gt;#{temp_text}&lt;/dd&gt;&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='text identifier id'>text</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="url_back_to_catalog-instance_method">
  
    - (<tt>Object</tt>) <strong>url_back_to_catalog</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
url back to catalog show the url back to the search result, keeping the
user&#8217;s facet, query and paging choices intact by using session. this
is to match against the http.referrer
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


799
800
801
802
803
804
805
806
807
808
809
810</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 799</span>

<span class='def def kw'>def</span> <span class='url_back_to_catalog identifier id'>url_back_to_catalog</span>
  <span class='query_params identifier id'>query_params</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:search</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='query_params identifier id'>query_params</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:counter</span>
  <span class='query_params identifier id'>query_params</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:total</span>
  <span class='if if kw'>if</span> <span class='query_params identifier id'>query_params</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:f</span><span class='rparen token'>)</span>
    <span class='query_params identifier id'>query_params</span><span class='lbrack token'>[</span><span class='symbol val'>:f</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='comma token'>,</span><span class='val identifier id'>val</span><span class='bitor op'>|</span>
      <span class='query_params identifier id'>query_params</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;f[#{key}][]&quot;</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='end end kw'>end</span>
    <span class='query_params identifier id'>query_params</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:f</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='query_params identifier id'>query_params</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="vern_document_heading-instance_method">
  
    - (<tt>Object</tt>) <strong>vern_document_heading</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
def application_name
</p>
<pre class="code">
  <span class='string val'>'SearchWorks (SULAIR)'</span>
</pre>
<p>
end
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/stanford/searchworks_helper.rb', line 9</span>

<span class='def def kw'>def</span> <span class='vern_document_heading identifier id'>vern_document_heading</span>
  <span class='@document ivar id'>@document</span><span class='lbrack token'>[</span><span class='Blacklight constant id'>Blacklight</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:show</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:vern_heading</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Jan 17 21:46:32 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.4 (ruby-1.8.7).
</div>

  </body>
</html>